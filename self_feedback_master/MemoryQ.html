{% extends "global/Page.html" %}
{% load static %}

{% block title %}Memory assignment{% endblock %}

{% block content %}

  {% comment %}
    Fälten hamnar automatiskt i <form>-taggen från global/Page.html.
  {% endcomment %}

  {% for q in questions %}
    <div class="mb-3">
      <label><strong>{{ q.prompt }}</strong></label><br>

      {# ───── Free recall ───── #}
      {% if q.kind == 'free' %}
        <textarea name="{{ q.name }}" rows="3"
                  class="form-control" required></textarea>

      {# ───── Single choice (radio) ───── #}
      {% elif q.kind == 'mcq' %}
        {% for opt in q.choices %}
          <div class="form-check">
            <input class="form-check-input" type="radio" required
                   name="{{ q.name }}" value="{{ opt }}"
                   id="{{ q.name }}_{{ forloop.counter }}">
            <label class="form-check-label" for="{{ q.name }}_{{ forloop.counter }}">
              {{ opt }}
            </label>
          </div>
        {% endfor %}
        {% if q.allow_other %}
          <input class="form-control mt-2"
                 placeholder="Other…" name="{{ q.name }}_other">
        {% endif %}

      {# ───── Multiple choice (checkbox) ───── #}
      {% elif q.kind == 'checkbox' %}
        {% for opt in q.choices %}
          <div class="form-check">
            <input class="form-check-input {{ q.name }}-chk"
                   type="checkbox"
                   name="{{ q.name }}" value="{{ opt }}"
                   id="{{ q.name }}_{{ forloop.counter }}">
            <label class="form-check-label" for="{{ q.name }}_{{ forloop.counter }}">
              {{ opt }}
            </label>
          </div>
        {% endfor %}
        {% if q.allow_other %}
          <input class="form-control mt-2"
                 placeholder="Other…" name="{{ q.name }}_other">
        {% endif %}

      {# ───── Binary yes/no ───── #}
      {% elif q.kind == 'binary' %}
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" required
                 name="{{ q.name }}" value="Yes" id="{{ q.name }}_yes">
          <label class="form-check-label" for="{{ q.name }}_yes">Yes</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" required
                 name="{{ q.name }}" value="No" id="{{ q.name }}_no">
          <label class="form-check-label" for="{{ q.name }}_no">No</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" required
                 name="{{ q.name }}" value="Don’t remember" id="{{ q.name }}_dont">
          <label class="form-check-label" for="{{ q.name }}_dont">Don’t remember</label>
        </div>
      {% endif %}
    </div>
  {% endfor %}

  <div class="d-flex justify-content-end mt-4">
    <button class="btn btn-primary" type="submit" id="nextBtn" disabled>Next</button>
  </div>

{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', () => {
  const form    = document.querySelector('form');
  const btn     = document.getElementById('nextBtn');

  // kolla initialt om alla required är uppfyllda
  toggleButton();

  // lyssna på alla input-händelser
  form.addEventListener('input', toggleButton);

  function toggleButton() {
    // 1) native HTML5-validering (textarea + radio + required)
    let valid = form.checkValidity();

    // 2) specialfall: varje checkbox-grupp måste ha minst ett kryss
    document.querySelectorAll('[class$="-chk"]').forEach(chk => {
      const group = chk.name;
      if (!document.querySelector('input[name="' + group + '"]:checked')) {
        valid = false;
      }
    });

    btn.disabled = !valid;
  }
});
</script>
{% endblock %}

