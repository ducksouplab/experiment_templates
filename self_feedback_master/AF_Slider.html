{% extends "global/Page.html" %}
{% load static %}

{% block global_styles %}
<style>
/* ----- Slider Appearance ----- */
input[type=range] {
    -webkit-appearance: none;
    accent-color: #d3d3d3;
    background: transparent;
}
input[type=range]::-webkit-slider-runnable-track {
    height: 6px;
    background: #d3d3d3;
    border-radius: 3px;
}
input[type=range]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 18px;
    height: 18px;
    border-radius: 50%;
    background: #666;
    margin-top: -6px;
    cursor: pointer;
}
input[type=range]::-moz-range-track {
    height: 6px;
    background: #d3d3d3;
    border-radius: 3px;
}
input[type=range]::-moz-range-progress {
    background: #d3d3d3;
}
input[type=range]::-moz-range-thumb {
    width: 18px;
    height: 18px;
    border-radius: 50%;
    background: #666;
    cursor: pointer;
}

/* Hide thumb initially */
input[type=range].unmoved::-webkit-slider-thumb {
    visibility: hidden;
}
input[type=range].unmoved::-moz-range-thumb {
    visibility: hidden;
}

/* ----- Layout ----- */
.slider-row {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}
.slider-row input[type=range] {
    flex: 1;
    width: auto;
}
.slider-face {
    width: 80px;
    position: relative;
    top: 4px;
}

/* Intensity cue image: visually overlaps, but mouse-transparent */
.intensity-img {
    width: calc(100% - 160px - 1rem + 12px);
    margin-top: -40px;
    pointer-events: none;
    z-index: 1;
}
</style>
{% endblock %}


{% block content %}
<p><strong>Please click on the Slides in order to indicate how the image made you feel.</strong></p>


<p class="text-muted text-end" style="margin-top:-20px;">
    Round {{ player.round_number }} of {{ C.NUM_ROUNDS }}
</p>

<form method="post">

  <!-- -------- Valence -------- -->
  <div class="form-group" style="margin-top:50px; margin-bottom:65px;">
    <div class="slider-row">
      <img src="{% static 'global/img/self-feedback/AS_unhappy.png' %}" class="slider-face" alt="Unhappy">
      <input type="range" name="af_valence" id="id_af_valence"
             min="-100" max="100" value="0">
      <img src="{% static 'global/img/self-feedback/AS_happy.png' %}" class="slider-face" alt="Happy">
    </div>
    <div class="d-flex justify-content-center">
      <img src="{% static 'global/img/self-feedback/AS_intensity_cue.png' %}" alt="Intensity cue" class="intensity-img">
    </div>
  </div>

  <!-- -------- Arousal -------- -->
  <div class="form-group">
    <div class="slider-row">
      <img src="{% static 'global/img/self-feedback/AS_sleepy.png' %}" class="slider-face" alt="Sleepy">
      <input type="range" name="af_arousal" id="id_af_arousal"
             min="-100" max="100" value="0">
      <img src="{% static 'global/img/self-feedback/AS_wideawake.png' %}" class="slider-face" alt="Wide awake">
    </div>
    <div class="d-flex justify-content-center">
      <img src="{% static 'global/img/self-feedback/AS_intensity_cue.png' %}" alt="Intensity cue" class="intensity-img">
    </div>
  </div>

   <div class="d-flex justify-content-end align-items-center" style="margin-top:40px; gap: 10px;">
  <button class="btn btn-primary" type="submit" disabled>Next</button>
</div>
<p style = "text-align: center;" id = "slider_text"> You must interact with both slider before you can click next.</p>

</form>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', () => {
  const sliders = document.querySelectorAll('form input[type="range"]');
  const submit = document.querySelector('form button[type="submit"]');

  sliders.forEach(slider => {
    slider.dataset.moved = 'false';
    slider.classList.add('unmoved');  // hide the thumb initially
  });

  submit.disabled = true;

  sliders.forEach(slider => {
    slider.addEventListener('input', () => {
      if (slider.dataset.moved === 'false') {
        slider.dataset.moved = 'true';
        slider.classList.remove('unmoved'); // show the thumb
      }

      const allMoved = [...sliders].every(s => s.dataset.moved === 'true');
      submit.disabled = !allMoved;
      if (allMoved){document.getElementById('slider_text').style.display = "none";}
    });
  });
});
</script>
{% endblock %}
